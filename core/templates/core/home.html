{% extends 'core/base.html' %}
{% load static %}
{% load humanize %}
{% block title %}Home | Mythical Esports{% endblock %}
{% block content %}
<div class="relative min-h-[400px] flex flex-col-reverse md:flex-row items-center justify-between rounded-3xl overflow-hidden bg-gradient-to-br from-orange-600 via-orange-400 to-yellow-400 shadow-xl p-4 sm:p-6 md:p-10 lg:p-16 mb-10 gap-8 md:gap-0">
    <div class="flex-1 z-10 flex flex-col justify-center items-start text-white max-w-full md:max-w-xl w-full">
        <span class="inline-block bg-white/20 text-orange-100 font-semibold px-4 py-1 rounded-full mb-4 text-xs sm:text-sm shadow">ðŸ”¥ Premier Esports Platform</span>
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight mb-4 drop-shadow-lg">
            Mythical <span class="text-yellow-300">Esports</span>
        </h1>
        <p class="text-base sm:text-lg md:text-2xl font-medium mb-6 sm:mb-8 text-white/90 drop-shadow">Experience the future of competitive gaming. Follow epic tournaments, legendary teams, and breaking news.</p>
        <div class="flex flex-col sm:flex-row gap-4 mb-8 w-full">
            <a href="{% url 'tournaments' %}" class="gradient-btn px-6 py-3 text-base sm:text-lg shadow-lg hover:scale-105 transition text-center w-full sm:w-auto">Explore Tournaments <i class="fa fa-arrow-right ml-2"></i></a>
            <a href="{% url 'streams' %}" class="px-6 py-3 text-base sm:text-lg rounded-lg border-2 border-white/70 text-white font-bold bg-white/10 hover:bg-white/20 transition shadow-lg text-center w-full sm:w-auto">Watch Streams & Videos</a>
        </div>
        <div class="flex flex-col sm:flex-row gap-6 sm:gap-12 mt-4 sm:mt-6 text-white/90 w-full items-center">
            <div class="flex flex-col items-start">
                <span class="text-2xl sm:text-3xl font-extrabold">{{ tournaments_count }}</span>
                <span class="text-xs sm:text-base font-medium">Tournaments</span>
            </div>
            <div class="flex flex-col items-start">
                <span class="text-2xl sm:text-3xl font-extrabold">{{ teams_count }}</span>
                <span class="text-xs sm:text-base font-medium">Teams</span>
            </div>
            <div class="flex flex-col items-start">
                <span class="text-2xl sm:text-3xl font-extrabold" id="prize-pool-value" data-npr="{{ prize_pool_sum|default:'0' }}">NPR {{ prize_pool_sum|default:"0"|intcomma }}</span>
                <span class="text-xs sm:text-base font-medium">Prize Pool</span>
            </div>
        </div>
    </div>
    <div class="flex-1 flex justify-center items-center z-0 mb-6 md:mb-0 w-full">
        <img src="{% static 'core/logo.png' %}" alt="Mythical Esports Logo" class="w-40 h-40 sm:w-60 sm:h-60 md:w-[340px] md:h-[340px] lg:w-[420px] lg:h-[420px] object-contain drop-shadow-2xl animate-fade-in-up" />
    </div>
    <div class="absolute inset-0 bg-gradient-to-br from-orange-700/80 via-orange-400/60 to-yellow-300/60 pointer-events-none" style="z-index:1;"></div>
</div>

{% if next_tournament %}
<div class="mb-6 p-4 bg-white rounded shadow">
    <h2 class="text-xl font-semibold">Next Tournament: {{ next_tournament.name }}</h2>
    <p>Game: {{ next_tournament.game }} | Prize: {{ next_tournament.prize_pool }} | Date: {{ next_tournament.date }}</p>
    <img src="{{ next_tournament.banner.url }}" alt="Banner" class="my-2 w-full max-w-md rounded">
    <div id="countdown" class="text-2xl font-bold"></div>
    <script>
        const eventDate = new Date("{{ next_tournament.date|date:'c' }}").getTime();
        const countdown = document.getElementById('countdown');
        setInterval(function() {
            const now = new Date().getTime();
            const distance = eventDate - now;
            if (distance < 0) {
                countdown.innerHTML = "Tournament Started!";
                return;
            }
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            countdown.innerHTML = days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
        }, 1000);
    </script>
</div>
{% endif %}

<div class="my-6">
    <h2 class="text-lg font-semibold mb-2">Subscribe to our Newsletter</h2>
    <form action="{% url 'subscribe' %}" method="post" class="flex max-w-md">
        {% csrf_token %}
        <input type="email" name="email" placeholder="Your email" required class="rounded-l px-2 py-1 border w-full">
        <button type="submit" class="bg-blue-500 text-white px-4 py-1 rounded-r">Subscribe</button>
    </form>
</div>

{% if sponsors %}
<div class="my-6">
    <h2 class="text-lg font-semibold mb-2">Our Sponsors</h2>
    <div class="flex flex-wrap gap-4">
        {% for sponsor in sponsors %}
            <a href="{{ sponsor.link }}" target="_blank">
                <img src="{{ sponsor.logo.url }}" alt="{{ sponsor.name }}" class="h-16 object-contain bg-white rounded shadow p-2">
            </a>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if testimonials %}
<div class="my-6">
    <h2 class="text-lg font-semibold mb-2">Testimonials</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for testimonial in testimonials %}
        <div class="bg-white p-4 rounded shadow flex items-center">
            {% if testimonial.photo %}
            <img src="{{ testimonial.photo.url }}" alt="{{ testimonial.name }}" class="h-12 w-12 rounded-full mr-4">
            {% endif %}
            <div>
                <p class="italic">"{{ testimonial.content }}"</p>
                <p class="font-semibold mt-2">- {{ testimonial.name }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if featured_streams %}
<div class="my-6">
    <h2 class="text-lg font-semibold mb-4">Live Streams</h2>
    <div class="flex flex-col md:flex-row flex-wrap gap-8 justify-center items-center">
        {% for stream in featured_streams %}
            <div class="bg-white/80 backdrop-blur rounded-2xl shadow-lg p-4 flex flex-col items-center w-full md:w-[620px]">
                <div class="w-full flex justify-center">
                {% if stream.platform == 'twitch' %}
                    <iframe src="https://player.twitch.tv/?channel={{ stream.url|cut:'https://www.twitch.tv/' }}&parent={{ request.get_host }}" frameborder="0" allowfullscreen="true" scrolling="no" height="378" width="620" class="rounded-xl"></iframe>
                {% elif stream.platform == 'youtube' %}
                    {% if 'watch?v=' in stream.url %}
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/{{ stream.url|cut:'https://www.youtube.com/watch?v=' }}" frameborder="0" allowfullscreen class="rounded-xl"></iframe>
                    {% elif 'channel/' in stream.url %}
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/live_stream?channel={{ stream.url|cut:'https://www.youtube.com/channel/' }}" frameborder="0" allowfullscreen class="rounded-xl"></iframe>
                    {% endif %}
                {% endif %}
                </div>
                <div class="text-center">
                    <h2 class="text-xl font-bold mb-2">{{ stream.name }}</h2>
                    <a href="{{ stream.url }}" target="_blank" class="text-orange-500 hover:underline">Go to Channel</a>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %} 